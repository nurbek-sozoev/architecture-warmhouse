<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Home Platform - AsyncAPI Documentation (Studio)</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #fafafa;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            margin: 0;
            font-size: 2rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
        }
        
        .container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        
        .nav-links {
            background: white;
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .nav-links a {
            display: inline-block;
            margin: 0 0.3rem;
            padding: 0.4rem 0.8rem;
            color: #667eea;
            text-decoration: none;
            border: 2px solid #667eea;
            border-radius: 4px;
            transition: all 0.3s ease;
            font-size: 0.85rem;
        }
        
        .nav-links a:hover {
            background: #667eea;
            color: white;
        }
        
        .nav-links a.active {
            background: #667eea;
            color: white;
        }
        
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 4px;
        }
        
        .asyncapi-wrapper {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .studio-iframe {
            width: 100%;
            height: 800px;
            border: none;
            border-radius: 8px;
        }
        
        .loading {
            text-align: center;
            padding: 2rem;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>‚ö° Smart Home Platform - –°–æ–±—ã—Ç–∏—è (Studio)</h1>
        <p>–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π —á–µ—Ä–µ–∑ AsyncAPI Studio</p>
    </div>
    
    <div class="container">
        <div class="asyncapi-wrapper" id="wrapper">
            <div class="loading" id="loading">
                üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ AsyncAPI Studio...
            </div>
            <iframe 
                id="studio-iframe"
                class="studio-iframe" 
                style="display: none;"
                title="AsyncAPI Studio"
                allow="accelerometer; camera; encrypted-media; geolocation; gyroscope; microphone; midi; payment; usb"
                sandbox="allow-forms allow-modals allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-downloads">
            </iframe>
        </div>
    </div>

    <script>
        window.addEventListener('DOMContentLoaded', () => {
            const loading = document.getElementById('loading');
            const iframe = document.getElementById('studio-iframe');
            const wrapper = document.getElementById('wrapper');
            
            console.log('–ó–∞–≥—Ä—É–∂–∞–µ–º AsyncAPI —á–µ—Ä–µ–∑ Studio...');
            
            fetch('/api-docs/asyncapi.yaml')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return response.text();
                })
                .then(yamlContent => {
                    console.log('AsyncAPI —Ñ–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω, —Ä–∞–∑–º–µ—Ä:', yamlContent.length, '—Å–∏–º–≤–æ–ª–æ–≤');
                    
                    const encodedYaml = encodeURIComponent(yamlContent);
                    const URL_LIMIT = 8192; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±–æ–ª–µ–µ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –ª–∏–º–∏—Ç

                    if (encodedYaml.length > URL_LIMIT) {
                        console.warn(`–ö–æ–Ω—Ç–µ–Ω—Ç YAML (${encodedYaml.length} —Å–∏–º–≤–æ–ª–æ–≤) —Å–ª–∏—à–∫–æ–º –≤–µ–ª–∏–∫ –¥–ª—è URL. –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π UI.`);
                        loading.style.display = 'none';
                        iframe.style.display = 'none';
                        
                        wrapper.innerHTML = `
                            <div style="text-align: left; padding: 2rem; border: 1px solid #ddd; border-radius: 8px; background: #fff;">
                                <h3>–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è —Å–ª–∏—à–∫–æ–º –≤–µ–ª–∏–∫–∞ –¥–ª—è –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏—è</h3>
                                <p style="margin-top: 0.5rem; color: #555;">–ò–∑-–∑–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –Ω–∞ –¥–ª–∏–Ω—É URL, —ç—Ç—É —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é –Ω–µ–ª—å–∑—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤ iframe. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π –º–µ—Ç–æ–¥:</p>
                                <ol style="margin-top: 1.5rem; margin-left: 1.5rem; line-height: 1.8;">
                                    <li style="margin-bottom: 1rem;">
                                        <strong>–®–∞–≥ 1:</strong> –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É, —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å YAML –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞.
                                        <br/>
                                        <button id="copy-btn" class="btn-action">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å YAML</button>
                                    </li>
                                    <li style="margin-bottom: 1rem;">
                                        <strong>–®–∞–≥ 2:</strong> –û—Ç–∫—Ä–æ–π—Ç–µ AsyncAPI Studio –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ.
                                        <br/>
                                        <a href="https://studio.asyncapi.com/" target="_blank" class="btn-action btn-studio">–û—Ç–∫—Ä—ã—Ç—å AsyncAPI Studio</a>
                                    </li>
                                    <li>
                                        <strong>–®–∞–≥ 3:</strong> –í—Å—Ç–∞–≤—å—Ç–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä Studio.
                                    </li>
                                </ol>
                                <hr style="margin: 2rem 0; border: none; border-top: 1px solid #eee;">
                                <h4>–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:</h4>
                                <pre style="background: #f8f9fa; border: 1px solid #e9ecef; padding: 1rem; border-radius: 4px; max-height: 250px; overflow-y: auto; white-space: pre-wrap; word-break: break-all;">${yamlContent.replace(/</g, "&lt;").replace(/>/g, "&gt;")}</pre>
                            </div>
                        `;

                        const style = document.createElement('style');
                        style.innerHTML = `
                            .btn-action { display: inline-block; font-weight: 600; color: white; padding: 0.8rem 1.5rem; text-decoration: none; border-radius: 6px; margin-top: 0.5rem; border: none; cursor: pointer; transition: all 0.2s ease; }
                            .btn-action:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
                            .btn-studio { background: #667eea; }
                            #copy-btn { background: #764ba2; }
                        `;
                        document.head.appendChild(style);

                        document.getElementById('copy-btn').addEventListener('click', () => {
                            navigator.clipboard.writeText(yamlContent).then(() => {
                                const btn = document.getElementById('copy-btn');
                                btn.textContent = '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
                                setTimeout(() => { btn.textContent = '–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å YAML'; }, 2000);
                            }, (err) => {
                                console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:', err);
                                alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç.');
                            });
                        });
                        return;
                    }

                    const studioUrl = `https://studio.asyncapi.com/?url=data:text/yaml;charset=utf-8,${encodedYaml}`;
                    iframe.src = studioUrl;
                    
                    iframe.onload = () => {
                        loading.style.display = 'none';
                        iframe.style.display = 'block';
                        console.log('AsyncAPI Studio –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ');
                    };
                    
                    setTimeout(() => {
                        if (loading.style.display !== 'none') {
                            loading.innerHTML = '‚ö†Ô∏è –ó–∞–≥—Ä—É–∑–∫–∞ Studio –∑–∞–Ω–∏–º–∞–µ—Ç –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏, —á–µ–º –æ–±—ã—á–Ω–æ...<br/>' +
                                             '<a href="' + studioUrl + '" target="_blank">–û—Ç–∫—Ä—ã—Ç—å –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ</a>, –µ—Å–ª–∏ –Ω–µ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è.';
                        }
                    }, 10000);
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ AsyncAPI —Ñ–∞–π–ª–∞:', error);
                    loading.innerHTML = `–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ AsyncAPI —Ñ–∞–π–ª–∞: ${error.message}<br/>` +
                                       '<a href="https://studio.asyncapi.com/" target="_blank">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å AsyncAPI Studio –Ω–∞–ø—Ä—è–º—É—é</a>';
                });
        });
    </script>
</body>
</html> 